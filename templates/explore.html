<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>HARNECT - Explore</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
<header class="top-nav">
   <div class="logo"><span style="color:#3498db;font-weight:bold;">HAR</span><span style="color:black;font-weight:bold;">NECT</span></div>
  <div class="page-title">Explore</div>
  <div class="theme-toggle" id="themeToggle">ğŸŒ™</div>
</header>

<!-- Search Bar -->
<form method="GET" action="{{ url_for('explore') }}" class="search-bar">
    <input type="text" name="query" placeholder="Search users, posts, videos..." value="{{ query or '' }}">
    <button type="submit">Search</button>
</form>

<!-- Search Results -->
{% if results %}
<div class="search-results">
    <h3>Search Results for "{{ query }}":</h3>
    <ul>
        {% for item in results %}
            <li>
                {% if item.type == 'user' %}
                    ğŸ‘¤ <a href="{{ url_for('profile', username=item.username) }}">@{{ item.username }}</a>
                {% elif item.type == 'post' %}
                    ğŸ“ Post by <strong>@{{ item.user }}</strong>: {{ item.content or item.caption }}
                    <br>
                    <img src="{{ url_for('static', filename='uploads/' + item.filename) }}" style="width:200px; border-radius:10px;">
                {% elif item.type == 'video' %}
                    ğŸ¬ Video by <strong>@{{ item.user }}</strong>: {{ item.title }}
                    <br>
                    <video width="200" controls style="border-radius:10px;">
                        <source src="{{ url_for('static', filename='uploads/' + item.filename) }}" type="video/mp4">
                        Your browser does not support video.
                    </video>
                {% endif %}
            </li>
        {% endfor %}
    </ul>
</div>
{% endif %}

<!-- Posts Grid -->
<main class="content explore-grid">
  {% for post in posts %}
    <div class="post">
      {% if post.filename.endswith(('.mp4','.webm','.mov','.avi')) %}
        <video controls width="100%" style="border-radius:10px;">
          <source src="{{ url_for('static', filename='uploads/' + post.filename) }}" type="video/mp4">
          Your browser does not support video.
        </video>
      {% else %}
        <img src="{{ url_for('static', filename='uploads/' + post.filename) }}" alt="{{ post.caption }}" style="width:100%; border-radius:10px;">
      {% endif %}

      <div class="post-info">
        <p><strong>@{{ post.user }}</strong></p>
        <p>{{ post.caption }}</p>
      </div>

      <div class="post-actions">
        <form action="{{ url_for('like_post', filename=post.filename) }}" method="POST" style="display:inline;">
          <button type="submit">â¤ï¸ {{ post.likes|length if post.likes else 0 }} Likes</button>
        </form>

        <form action="{{ url_for('comment_post', filename=post.filename) }}" method="POST" style="display:inline;">
          <input type="text" name="comment" placeholder="Add comment..." required>
          <button type="submit">ğŸ’¬ Comment</button>
        </form>
      </div>

      {% if post.comments %}
      <div class="comments">
        {% for c in post.comments %}
          <p><strong>@{{ c.user }}:</strong> {{ c.text }}</p>
        {% endfor %}
      </div>
      {% endif %}
    </div>
  {% endfor %}
</main>

<!-- Bottom Navigation -->
<nav class="bottom-nav">
  <a href="{{ url_for('index') }}">ğŸ <span>Home</span></a>
  <a href="{{ url_for('explore') }}" class="active">ğŸ”<span>Explore</span></a>
  <a href="{{ url_for('upload') }}" class="upload-btn">â•</a>
  <a href="{{ url_for('feedback') }}">ğŸ’¬<span>Feedback</span></a>
  <a href="{% if user %}{{ url_for('profile', username=user) }}{% else %}{{ url_for('login') }}{% endif %}">ğŸ‘¤<span>Profile</span></a>
</nav>

<script src="{{ url_for('static', filename='script.js') }}"></script>
</body>
</html>